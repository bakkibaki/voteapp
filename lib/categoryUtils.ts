const CATEGORY_KEYWORDS: Record<string, string[]> = {
  '就活・転職': ['就活', '就職', '転職', '求人', '面接', 'ES', 'エントリーシート', '企業', '会社', '採用', '内定', '新卒', '中途', 'インターン', 'キャリア', '履歴書', '職務経歴書', '面談'],
  '恋愛・結婚': ['恋愛', '恋人', 'カップル', 'デート', '告白', 'プロポーズ', '結婚', '婚活', 'マッチング', '出会い', '彼氏', '彼女', '夫婦', '結婚式', 'ブライダル', '婚約'],
  '学校・教育': ['学校', '大学', '高校', '中学', '小学校', '勉強', '受験', '試験', 'テスト', '授業', '教育', '先生', '教師', '塾', '予備校', '学習', '宿題', '卒業', '入学'],
  'ビジネス': ['ビジネス', '仕事', '会議', 'プレゼン', '営業', 'マーケティング', '経営', '起業', 'スタートアップ', '副業', 'フリーランス', '在宅', 'リモート', 'テレワーク'],
  'ライフスタイル': ['朝食', '昼食', '夕食', '食事', '料理', '趣味', '休日', '生活', '家事', '掃除', '洗濯', 'インテリア', '部屋', 'ペット', '睡眠', '日常', 'ルーティン'],
  'テクノロジー': ['スマホ', 'パソコン', 'PC', 'アプリ', 'AI', 'プログラミング', 'ソフトウェア', 'ハードウェア', 'iPhone', 'Android', 'Mac', 'Windows', 'IT', 'ネット', 'インターネット', 'SNS', 'Twitter', 'Instagram', 'YouTube', 'サイト', 'クラウド', 'セキュリティ'],
  'エンターテイメント': ['エンタメ', '娯楽', 'テレビ', '番組', '配信', 'Netflix', 'Amazon Prime', 'Hulu', 'ストリーミング'],
  'スポーツ': ['サッカー', '野球', 'バスケ', 'テニス', 'ゴルフ', 'ラグビー', 'バレー', '水泳', 'マラソン', '柔道', '格闘技', 'オリンピック', 'ワールドカップ', '試合', '選手', 'チーム', '練習', 'トレーニング', 'ジム'],
  '政治': ['選挙', '政治', '政党', '国会', '首相', '大統領', '政策', '法律', '憲法', '税金', '外交', '国際', '経済政策', '年金', '社会保障'],
  '健康・美容': ['健康', '運動', 'ダイエット', '美容', 'スキンケア', 'メイク', 'コスメ', '化粧', 'エステ', 'サロン', 'ヨガ', 'ストレッチ', '筋トレ', '医療', '病院'],
  'グルメ': ['料理', '食事', 'レシピ', 'レストラン', 'カフェ', 'グルメ', '美味しい', 'スイーツ', 'デザート', 'ラーメン', '寿司', '焼肉', 'イタリアン', 'フレンチ', '中華', '和食', 'B級グルメ'],
  '旅行': ['旅行', '観光', 'ホテル', '温泉', '旅館', '海外', '国内', 'リゾート', '名所', '世界遺産', 'ツアー', 'バックパック', '出張'],
  'ファッション': ['ファッション', '服', '洋服', 'コーデ', 'ブランド', 'おしゃれ', 'スタイル', 'トレンド', 'アパレル', '靴', 'バッグ', 'アクセサリー'],
  '音楽': ['音楽', 'ライブ', 'コンサート', 'アーティスト', 'バンド', 'アイドル', '歌', '楽器', 'ギター', 'ピアノ', 'ドラム', 'フェス', 'CD', 'サブスク', 'Spotify', 'Apple Music'],
  '映画・ドラマ': ['映画', 'ドラマ', '俳優', '女優', '監督', '作品', 'シリーズ', 'シーズン', '劇場', '映画館', 'DVD', 'Blu-ray'],
  'アニメ・マンガ': ['アニメ', '漫画', 'マンガ', 'コミック', 'キャラ', '声優', 'ジャンプ', 'マガジン', 'サンデー', '原作', 'アニメ化', '劇場版'],
  'ゲーム': ['ゲーム', 'ゲーム機', 'PlayStation', 'Nintendo', 'Switch', 'Xbox', 'スマホゲーム', 'ソシャゲ', 'RPG', 'アクション', 'FPS', 'eスポーツ', 'Steam', 'ゲーマー'],
  'お金・投資': ['お金', '投資', '株', '株式', '資産', '貯金', '節約', '副収入', '不動産', '仮想通貨', 'クレカ', 'クレジットカード', 'ポイント', '保険', 'ローン', 'NISA', 'iDeCo'],
  '住まい': ['住まい', '家', 'マンション', 'アパート', '一戸建て', '賃貸', '持ち家', '引っ越し', '不動産', 'インテリア', 'リフォーム', 'DIY', 'ホームセンター'],
};

export function suggestCategory(title: string): string {
  const lowerTitle = title.toLowerCase();

  for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
    for (const keyword of keywords) {
      if (lowerTitle.includes(keyword.toLowerCase())) {
        return category;
      }
    }
  }

  return 'その他';
}

// トレンドカテゴリーを取得（投票数が多い順）
export function getTrendingCategories(votes: any[]): string[] {
  const categoryCounts: Record<string, number> = {};

  // 各カテゴリーの投票数を集計
  votes.forEach(vote => {
    const category = vote.category || 'その他';
    const totalVotes = vote.options?.reduce((sum: number, opt: any) => sum + (opt.votes || 0), 0) || 0;
    categoryCounts[category] = (categoryCounts[category] || 0) + totalVotes;
  });

  // カテゴリーを投票数でソート
  const sortedCategories = Object.entries(categoryCounts)
    .sort((a, b) => b[1] - a[1])
    .map(([category]) => category);

  // すべてのカテゴリーを含めるため、投票がないカテゴリーも追加
  const allCategories = [
    '就活・転職',
    '恋愛・結婚',
    '学校・教育',
    'ビジネス',
    'ライフスタイル',
    'テクノロジー',
    'エンターテイメント',
    'スポーツ',
    '政治',
    '健康・美容',
    'グルメ',
    '旅行',
    'ファッション',
    '音楽',
    '映画・ドラマ',
    'アニメ・マンガ',
    'ゲーム',
    'お金・投資',
    '住まい',
    'その他',
  ];

  // トレンドカテゴリーに含まれていないカテゴリーを後ろに追加
  const remainingCategories = allCategories.filter(cat => !sortedCategories.includes(cat));

  return [...sortedCategories, ...remainingCategories];
}
